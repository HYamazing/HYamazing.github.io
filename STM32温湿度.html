<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>STM32 æ¸©æ¹¿åº¦ï½œå¹»å±¿é€ æ¢¦ç§‘æŠ€å®éªŒå®¤</title>

  <style>
    :root{
      --bg1:#0ea5e9; --bg2:#8b5cf6;
      --card:#ffffff; --text:#0f172a; --muted:#475569; --line:#e2e8f0;
      --shadow: 0 20px 50px rgba(2, 6, 23, .15);
      --radius:18px;
      --ok:#16a34a; --bad:#ef4444;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(255,255,255,.35), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    a{color:inherit; text-decoration:none;}
    .wrap{max-width: 980px; margin:0 auto; padding:18px 18px 60px;}

    .topbar{
      position: sticky; top: 12px; z-index: 50;
      display:flex; justify-content:space-between; align-items:center; gap:12px;
      padding: 10px 12px; border-radius: 16px;
      background: rgba(255,255,255,.18);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 10px 25px rgba(0,0,0,.08);
      color: rgba(255,255,255,.95);
      margin-bottom: 14px;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:700;}
    .brand-badge{width:34px; height:34px; border-radius:10px; background: rgba(255,255,255,.20); display:grid; place-items:center;}
    .nav{display:flex; gap:10px; flex-wrap:wrap; font-size:14px;}
    .nav a{padding:8px 10px; border-radius:999px; background: rgba(255,255,255,.16);}
    .nav a:hover{background: rgba(255,255,255,.24);}

    .card{background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden;}
    .header{
      padding:22px 22px 16px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(14,165,233,.10), transparent);
    }
    .header h1{margin:0 0 6px; font-size:26px;}
    .header p{margin:0; color:var(--muted); line-height:1.8;}

    .content{padding:18px;}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 820px){ .grid{grid-template-columns:1fr;} }

    .panel{
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 16px;
      background:#fff;
    }
    .panel h2{margin:0 0 10px; font-size:18px;}

    .big{display:flex; align-items:flex-end; gap:10px;}
    .value{font-size: 52px; font-weight: 800; line-height: 1;}
    .unit{font-size: 16px; color: var(--muted); padding-bottom: 8px;}

    .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-top: 12px;
      color: var(--muted);
      font-size: 14px;
      flex-wrap: wrap;
    }

    .dot{
      width:10px; height:10px; border-radius:999px; display:inline-block;
      background: var(--bad);
      box-shadow: 0 0 0 4px rgba(239,68,68,.12);
      margin-right: 8px;
    }
    .dot.ok{
      background: var(--ok);
      box-shadow: 0 0 0 4px rgba(22,163,74,.12);
    }

    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px;}
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:12px;
      border:1px solid #e2e8f0; background:#fff; font-size:14px;
      cursor:pointer;
    }
    .btn:hover{background:#f8fafc;}
    .btn.primary{background:#0f172a; color:#fff; border-color:#0f172a;}
    .btn.primary:hover{background:#111c33;}

    /* ===== æŠ˜çº¿å›¾å®¹å™¨ ===== */
    .chart-wrap{
      margin-top: 12px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .legend{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      color: var(--muted);
      font-size: 13px;
      align-items:center;
      justify-content: space-between;
    }
    .legend-left{display:flex; gap:12px; flex-wrap:wrap; align-items:center;}
    .key{
      display:flex; align-items:center; gap:8px;
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:#fff;
    }
    .swatch{
      width:10px; height:10px; border-radius:999px;
      background:#0f172a; /* é»˜è®¤é¢œè‰²ï¼Œå…·ä½“åœ¨ JS é‡Œç”¨ canvas ç”»çº¿ï¼Œä¸ä¾èµ–è¿™ä¸ªé¢œè‰² */
    }
    canvas{
      width: 100%;
      height: 260px;           /* è§†è§‰é«˜åº¦ */
      border: 1px solid var(--line);
      border-radius: 14px;
      background: #fff;
    }

    .code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      color: #0f172a;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      padding: 10px;
      border-radius: 12px;
      overflow:auto;
    }

    .footer{text-align:center; color: rgba(255,255,255,.88); font-size:13px; margin-top:16px; opacity:.95;}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="brand-badge">ğŸŒ¡ï¸</div>
        <div>STM32 æ¸©æ¹¿åº¦</div>
      </div>
      <div class="nav">
        <a href="index.html">è¿”å›ä¸»é¡µ</a>
        <a href="#data">æ•°æ®</a>
        <a href="#chart">æŠ˜çº¿å›¾</a>
        <a href="#api">æ¥å£</a>
      </div>
    </div>

    <div class="card">
      <div class="header">
        <h1>æ¸©æ¹¿åº¦å®æ—¶å±•ç¤ºï¼ˆç½‘é¡µç«¯å…ˆæ­å¥½ï¼‰</h1>
        <p>
          ç›®æ ‡ï¼šSTM32F103C8T6 + DHT11 é‡‡é›† â†’ ESP8266 å‘é€åˆ°æ¥å£ â†’ æœ¬é¡µé¢å®šæ—¶æ‹‰å–æœ€æ–°æ•°æ®å¹¶æ˜¾ç¤ºã€‚
          ç›®å‰å…ˆç”¨â€œæ¨¡æ‹Ÿæ•°æ® + æŠ˜çº¿å›¾â€è·‘é€šé¡µé¢ç»“æ„ï¼Œåç»­å†æ¥å…¥çœŸå®æ¥å£ã€‚
        </p>
      </div>

      <div class="content">
        <div class="grid" id="data">
          <div class="panel">
            <h2>æ¸©åº¦</h2>
            <div class="big">
              <div class="value" id="temp">--</div>
              <div class="unit">Â°C</div>
            </div>
            <div class="row">
              <div>
                çŠ¶æ€ï¼š
                <span class="dot" id="dot"></span>
                <span id="statusText">ç¦»çº¿/æš‚æ— æ•°æ®</span>
              </div>
              <div>æ›´æ–°æ—¶é—´ï¼š<span id="updatedAt">--</span></div>
            </div>
          </div>

          <div class="panel">
            <h2>æ¹¿åº¦</h2>
            <div class="big">
              <div class="value" id="hum">--</div>
              <div class="unit">%RH</div>
            </div>

            <div class="btns">
              <button class="btn primary" id="btnMock">æ¨¡æ‹Ÿåˆ·æ–°æ•°æ®ï¼ˆè¿½åŠ åˆ°æŠ˜çº¿å›¾ï¼‰</button>
              <button class="btn" id="btnRefresh">ï¼ˆé¢„ç•™ï¼‰ä»æ¥å£åˆ·æ–°</button>
              <button class="btn" id="btnReset">æ¸…ç©ºæŠ˜çº¿å›¾æ•°æ®</button>
            </div>

            <div class="row">
              <div>è¯´æ˜ï¼šæ¨¡æ‹ŸæŒ‰é’®ä¼šæŠŠæ•°æ®å†™å…¥â€œæœ€è¿‘1å°æ—¶æ›²çº¿â€ã€‚</div>
            </div>
          </div>
        </div>

        <!-- æŠ˜çº¿å›¾åŒºåŸŸï¼šæœ€è¿‘ 1 å°æ—¶ -->
        <div class="panel" id="chart" style="margin-top:12px;">
          <h2>æœ€è¿‘ 1 å°æ—¶æ›²çº¿ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰</h2>

          <div class="chart-wrap">
            <div class="legend">
              <div class="legend-left">
                <div class="key"><span class="swatch" id="swTemp"></span>æ¸©åº¦</div>
                <div class="key"><span class="swatch" id="swHum"></span>æ¹¿åº¦</div>
              </div>
              <div style="color:var(--muted);">
                æ•°æ®ç‚¹ï¼š<span id="pointCount">0</span>ï¼ˆè‡ªåŠ¨ä¿ç•™æœ€è¿‘ 60 åˆ†é’Ÿï¼‰
              </div>
            </div>

            <!-- åŸç”Ÿ Canvas æŠ˜çº¿å›¾ï¼ˆä¸ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼ŒGitHub Pages å¯ç”¨ï¼‰ -->
            <canvas id="chartCanvas" width="1000" height="520"></canvas>

            <div class="row">
              <div>æ¨ªè½´ï¼šæ—¶é—´ï¼ˆæœ€è¿‘1å°æ—¶ï¼‰</div>
              <div>çºµè½´ï¼šæ¸©åº¦/æ¹¿åº¦ï¼ˆåˆ†åˆ«è‡ªé€‚åº”èŒƒå›´ï¼‰</div>
            </div>
          </div>
        </div>

        <div class="panel" id="api" style="margin-top:12px;">
          <h2>æ¥å£é¢„ç•™ï¼ˆæœªæ¥æ¥å…¥ç¡¬ä»¶æ—¶è¦ç”¨ï¼‰</h2>
          <p style="color:var(--muted); line-height:1.8; margin:0 0 10px;">
            GitHub Pages æ˜¯é™æ€ç«™ï¼Œä¸èƒ½ç›´æ¥æ¥æ”¶ STM32 ä¸Šä¼ çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªâ€œä¸­é—´ APIâ€ï¼ˆæ¯”å¦‚ Cloudflare Workersï¼‰ã€‚
            åç»­ä½ åªè¦æŠŠä¸‹é¢çš„ API åœ°å€æ¢æˆçœŸå®åœ°å€ï¼Œå¹¶å®ç°ä¸¤ä¸ªæ¥å£å³å¯ã€‚
          </p>

          <div class="code">
/* è®¾å¤‡ä¸Šä¼ ï¼ˆSTM32/ESP8266 è°ƒç”¨ï¼‰ï¼š
   GET  /api/upload?temp=25&hum=60&key=xxx
   æˆ–  POST /api/upload  { temp:25, hum:60, key:"xxx" }

   ç½‘é¡µè¯»å–æœ€æ–°æ•°æ®ï¼ˆæœ¬é¡µé¢è°ƒç”¨ï¼‰ï¼š
   GET /api/latest  ->  { temp: 25, hum: 60, updatedAt: "2025-12-23 16:20:00" }
*/
          </div>
        </div>
      </div>
    </div>

    <div class="footer">Â© <span id="y">2025</span> å¹»å±¿é€ æ¢¦ç§‘æŠ€å®éªŒå®¤ Â· STM32 å·¥ç¨‹é¡µ</div>
  </div>

  <script>
    /* =========================================================
       æœ¬é¡µåŠŸèƒ½è¯´æ˜ï¼ˆé›¶åŸºç¡€ç‰ˆï¼‰
       1) â€œæ¨¡æ‹Ÿåˆ·æ–°æ•°æ®â€ï¼šéšæœºç”Ÿæˆä¸€ç»„æ¸©æ¹¿åº¦ï¼Œå¹¶æ˜¾ç¤ºåœ¨å¤§æ•°å­—ä¸Š
       2) åŒæ—¶æŠŠè¿™ç»„æ•°æ®è¿½åŠ åˆ°æŠ˜çº¿å›¾ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
       3) æŠ˜çº¿å›¾è‡ªåŠ¨åªä¿ç•™æœ€è¿‘ 60 åˆ†é’Ÿçš„æ•°æ®
       4) Canvas ç”»å›¾ï¼šçº¯åŸç”Ÿï¼Œä¸ä¾èµ–å¤–éƒ¨åº“ï¼ˆGitHub Pages é€‚é…æœ€å¥½ï¼‰
       ========================================================= */

    /* ---------- æ—¶é—´æ ¼å¼å·¥å…· ---------- */
    function pad(n){ return n < 10 ? "0"+n : ""+n; }
    function fmt(d){
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }
    function fmtHM(d){
      return `${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    /* ---------- é¡µé¢å…ƒç´ å¼•ç”¨ ---------- */
    const elTemp = document.getElementById("temp");
    const elHum = document.getElementById("hum");
    const elUpdatedAt = document.getElementById("updatedAt");
    const elDot = document.getElementById("dot");
    const elStatus = document.getElementById("statusText");
    const elPointCount = document.getElementById("pointCount");

    const canvas = document.getElementById("chartCanvas");
    const ctx = canvas.getContext("2d");

    // å›¾ä¾‹è‰²å—ï¼ˆä»…ç”¨äºè§†è§‰æç¤ºï¼›å®é™…ç”»çº¿ä¹Ÿç”¨åŒæ ·é¢œè‰²ï¼‰
    const swTemp = document.getElementById("swTemp");
    const swHum  = document.getElementById("swHum");

    // çº¿æ¡é¢œè‰²ï¼ˆä½ ä¹Ÿå¯ä»¥æ”¹ï¼‰
    const COLOR_TEMP = "#0f172a";  // æ¸©åº¦çº¿é¢œè‰²
    const COLOR_HUM  = "#2563eb";  // æ¹¿åº¦çº¿é¢œè‰²

    swTemp.style.background = COLOR_TEMP;
    swHum.style.background  = COLOR_HUM;

    function setOnline(online){
      if(online){
        elDot.classList.add("ok");
        elStatus.textContent = "åœ¨çº¿ï¼ˆæ¨¡æ‹Ÿï¼‰";
      }else{
        elDot.classList.remove("ok");
        elStatus.textContent = "ç¦»çº¿/æš‚æ— æ•°æ®";
      }
    }

    /* =========================================================
       æŠ˜çº¿å›¾æ•°æ®ç»“æ„ï¼š
       points = [{ t: æ—¶é—´æˆ³(ms), temp: æ•°å­—, hum: æ•°å­— }, ...]
       ========================================================= */
    const points = [];

    // åªä¿ç•™æœ€è¿‘ 60 åˆ†é’Ÿï¼ˆ3600000 msï¼‰
    const WINDOW_MS = 60 * 60 * 1000;

    // å›¾è¡¨å†…è¾¹è·ï¼ˆç•™ç»™åæ ‡ã€æ–‡å­—ï¼‰
    const PADDING = { left: 60, right: 20, top: 20, bottom: 50 };

    /* ---------- æ¨¡æ‹Ÿç”Ÿæˆå¹¶è¿½åŠ æ•°æ® ---------- */
    function mockData(){
      const now = new Date();

      // ç”Ÿæˆåˆç†èŒƒå›´çš„æ¨¡æ‹Ÿæ•°æ®
      const temp = +(20 + Math.random() * 10).toFixed(1); // 20~30â„ƒ
      const hum  = +(40 + Math.random() * 30).toFixed(1); // 40~70%

      // 1) æ›´æ–°å¤§æ•°å­—æ˜¾ç¤º
      elTemp.textContent = temp.toFixed(1);
      elHum.textContent = hum.toFixed(1);
      elUpdatedAt.textContent = fmt(now);
      setOnline(true);

      // 2) è¿½åŠ åˆ°æŠ˜çº¿å›¾æ•°æ®
      points.push({ t: now.getTime(), temp, hum });

      // 3) æ¸…ç† 60 åˆ†é’Ÿå‰çš„æ•°æ®
      trimOldPoints();

      // 4) æ›´æ–°ç‚¹æ•°å¹¶é‡ç”»
      elPointCount.textContent = String(points.length);
      drawChart();
    }

    function trimOldPoints(){
      const cutoff = Date.now() - WINDOW_MS;
      // åˆ é™¤è¿‡æ—§æ•°æ®ç‚¹ï¼ˆä»å‰å¾€ååˆ ï¼‰
      while(points.length > 0 && points[0].t < cutoff){
        points.shift();
      }
    }

    /* =========================================================
       Canvas ç»˜åˆ¶æŠ˜çº¿å›¾ï¼ˆæ ¸å¿ƒï¼‰
       - X è½´ï¼šæ—¶é—´ï¼ˆæœ€è¿‘1å°æ—¶ï¼‰
       - Y è½´ï¼šæ¸©åº¦/æ¹¿åº¦åˆ†åˆ«è‡ªé€‚åº”èŒƒå›´ï¼ˆå„è‡ªçš„ min/maxï¼‰
       ========================================================= */
    function drawChart(){
      // ç”»å¸ƒåƒç´ å°ºå¯¸ï¼ˆæ³¨æ„ï¼šcanvas çš„ width/height æ˜¯åƒç´ ï¼ŒCSS æ˜¯æ˜¾ç¤ºå°ºå¯¸ï¼‰
      const W = canvas.width;
      const H = canvas.height;

      // æ¸…ç©º
      ctx.clearRect(0, 0, W, H);

      // æ²¡æ•°æ®æ—¶æç¤º
      if(points.length === 0){
        ctx.fillStyle = "#475569";
        ctx.font = "16px Microsoft YaHei, Arial";
        ctx.fillText("æš‚æ— æ•°æ®ï¼šç‚¹å‡»â€œæ¨¡æ‹Ÿåˆ·æ–°æ•°æ®â€å¼€å§‹ç”Ÿæˆæ›²çº¿", 80, 80);
        return;
      }

      const left = PADDING.left;
      const right = W - PADDING.right;
      const top = PADDING.top;
      const bottom = H - PADDING.bottom;

      // X è½´èŒƒå›´ï¼šæœ€è¿‘1å°æ—¶çª—å£ï¼ˆç”¨â€œç°åœ¨â€ä¸ºå³ç«¯ï¼‰
      const xMax = Date.now();
      const xMin = xMax - WINDOW_MS;

      // Y è½´èŒƒå›´ï¼šåˆ†åˆ«è®¡ç®—æ¸©åº¦/æ¹¿åº¦çš„ min/maxï¼ˆåŠ ä¸€ç‚¹è¾¹ç•Œæ›´å¥½çœ‹ï¼‰
      const temps = points.map(p => p.temp);
      const hums  = points.map(p => p.hum);

      const tMin = Math.min(...temps);
      const tMax = Math.max(...temps);
      const hMin = Math.min(...hums);
      const hMax = Math.max(...hums);

      const tPad = Math.max(0.5, (tMax - tMin) * 0.2);
      const hPad = Math.max(1.0, (hMax - hMin) * 0.2);

      const yTempMin = tMin - tPad;
      const yTempMax = tMax + tPad;
      const yHumMin  = hMin - hPad;
      const yHumMax  = hMax + hPad;

      // æŠŠâ€œæ—¶é—´â†’xåæ ‡â€
      const tx = (ms) => {
        const ratio = (ms - xMin) / (xMax - xMin);
        return left + ratio * (right - left);
      };

      // æŠŠâ€œæ¸©åº¦â†’yåæ ‡â€
      const tyTemp = (v) => {
        const ratio = (v - yTempMin) / (yTempMax - yTempMin);
        return bottom - ratio * (bottom - top);
      };

      // æŠŠâ€œæ¹¿åº¦â†’yåæ ‡â€
      const tyHum = (v) => {
        const ratio = (v - yHumMin) / (yHumMax - yHumMin);
        return bottom - ratio * (bottom - top);
      };

      /* ---------- 1) ç”»ç½‘æ ¼ä¸åæ ‡è½´ ---------- */
      ctx.strokeStyle = "#e2e8f0";
      ctx.lineWidth = 1;

      // æ¨ªå‘ç½‘æ ¼ï¼ˆ5æ¡ï¼‰
      for(let i=0; i<=5; i++){
        const y = top + (i/5) * (bottom - top);
        ctx.beginPath();
        ctx.moveTo(left, y);
        ctx.lineTo(right, y);
        ctx.stroke();
      }

      // çºµå‘ç½‘æ ¼ï¼ˆ6æ¡ï¼‰
      for(let i=0; i<=6; i++){
        const x = left + (i/6) * (right - left);
        ctx.beginPath();
        ctx.moveTo(x, top);
        ctx.lineTo(x, bottom);
        ctx.stroke();
      }

      // åæ ‡è½´è¾¹æ¡†
      ctx.strokeStyle = "#cbd5e1";
      ctx.strokeRect(left, top, right-left, bottom-top);

      /* ---------- 2) ç”» X è½´åˆ»åº¦ï¼ˆæ—¶é—´ï¼‰ ---------- */
      ctx.fillStyle = "#475569";
      ctx.font = "12px Microsoft YaHei, Arial";

      for(let i=0; i<=6; i++){
        const ms = xMin + (i/6) * (xMax - xMin);
        const x = tx(ms);
        const d = new Date(ms);
        const label = fmtHM(d);

        ctx.fillText(label, x - 16, bottom + 22);
      }

      /* ---------- 3) ç”»å·¦ä¾§æ¸©åº¦åˆ»åº¦ï¼ˆæ¸©åº¦ï¼‰ ---------- */
      for(let i=0; i<=5; i++){
        const v = yTempMax - (i/5) * (yTempMax - yTempMin);
        const y = tyTemp(v);
        ctx.fillText(v.toFixed(1), 8, y + 4);  // å·¦è¾¹é å¤–
      }

      /* ---------- 4) ç”»å³ä¾§æ¹¿åº¦åˆ»åº¦ï¼ˆæ¹¿åº¦ï¼‰ ---------- */
      // å³ä¾§åˆ»åº¦æ–‡å­—å¯¹é½å³è¾¹
      ctx.textAlign = "right";
      for(let i=0; i<=5; i++){
        const v = yHumMax - (i/5) * (yHumMax - yHumMin);
        const y = tyHum(v);
        ctx.fillText(v.toFixed(1), W - 8, y + 4);
      }
      ctx.textAlign = "left";

      // æ ‡æ³¨å•ä½ï¼ˆå¯è¯»æ€§ï¼‰
      ctx.fillStyle = "#0f172a";
      ctx.fillText("æ¸©åº¦(Â°C)", left, top - 6);
      ctx.textAlign = "right";
      ctx.fillText("æ¹¿åº¦(%RH)", right, top - 6);
      ctx.textAlign = "left";

      /* ---------- 5) ç”»æŠ˜çº¿ï¼šæ¸©åº¦ ---------- */
      drawLine(points, (p)=>tx(p.t), (p)=>tyTemp(p.temp), COLOR_TEMP);

      /* ---------- 6) ç”»æŠ˜çº¿ï¼šæ¹¿åº¦ ---------- */
      drawLine(points, (p)=>tx(p.t), (p)=>tyHum(p.hum), COLOR_HUM);

      /* ---------- 7) ç”»æœ€æ–°ç‚¹çš„å°åœ†ç‚¹ ---------- */
      const last = points[points.length - 1];
      drawDot(tx(last.t), tyTemp(last.temp), COLOR_TEMP);
      drawDot(tx(last.t), tyHum(last.hum), COLOR_HUM);
    }

    // ç”»ä¸€æ¡æŠ˜çº¿ï¼ˆé€šç”¨å‡½æ•°ï¼‰
    function drawLine(arr, getX, getY, color){
      ctx.strokeStyle = color;
      ctx.lineWidth = 3;
      ctx.beginPath();

      for(let i=0; i<arr.length; i++){
        const x = getX(arr[i]);
        const y = getY(arr[i]);
        if(i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();
    }

    // ç”»ä¸€ä¸ªå°åœ†ç‚¹
    function drawDot(x, y, color){
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, 4.5, 0, Math.PI*2);
      ctx.fill();
    }

    /* ---------- æ¸…ç©ºæ•°æ® ---------- */
    function resetChart(){
      points.length = 0;
      elPointCount.textContent = "0";
      setOnline(false);
      elTemp.textContent = "--";
      elHum.textContent = "--";
      elUpdatedAt.textContent = "--";
      drawChart();
    }

    /* ---------- é¢„ç•™ï¼šæœªæ¥æ¥çœŸå®æ¥å£ ---------- */
    async function fetchLatest(){
      alert("æ¥å£è¿˜æ²¡æ¥å…¥ï¼šå½“å‰åªæ”¯æŒâ€œæ¨¡æ‹Ÿåˆ·æ–°æ•°æ®â€ã€‚");
    }

    /* ---------- ç»‘å®šæŒ‰é’® ---------- */
    document.getElementById("btnMock").addEventListener("click", mockData);
    document.getElementById("btnRefresh").addEventListener("click", fetchLatest);
    document.getElementById("btnReset").addEventListener("click", resetChart);

    /* ---------- é¡µé¢åˆå§‹åŒ– ---------- */
    document.getElementById("y").textContent = new Date().getFullYear();
    setOnline(false);
    drawChart();

    /* =========================================================
       å¯é€‰ï¼šç»™ä½ ä¸€ä¸ªâ€œè‡ªåŠ¨ç”Ÿæˆ 1 å°æ—¶å†å²æ•°æ®â€çš„å¼€å…³ï¼ˆé»˜è®¤å…³é—­ï¼‰
       ä½ æƒ³ä¸€æ‰“å¼€é¡µé¢å°±æœ‰æ›²çº¿ï¼Œå¯ä»¥æŠŠä¸‹é¢çš„å‡½æ•°è°ƒç”¨å–æ¶ˆæ³¨é‡Šã€‚
       ========================================================= */
    function seed1HourData(){
      const now = Date.now();
      // æ¯ 1 åˆ†é’Ÿä¸€ä¸ªç‚¹ï¼Œæ€»å…± 60 ä¸ªç‚¹
      for(let i=60; i>=1; i--){
        const t = now - i * 60 * 1000;
        const temp = +(24 + Math.sin(i/8) * 2 + Math.random()).toFixed(1);
        const hum  = +(55 + Math.cos(i/10) * 6 + Math.random()*2).toFixed(1);
        points.push({ t, temp, hum });
      }
      trimOldPoints();
      elPointCount.textContent = String(points.length);
      drawChart();
    }
    // seed1HourData(); // â† æƒ³è¦é»˜è®¤æœ‰æ›²çº¿å°±æŠŠè¿™è¡Œå‰é¢çš„ // å»æ‰
  </script>
</body>
</html>
